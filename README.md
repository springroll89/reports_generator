# 报告生成器（Cross-Platform Report Generator）




## **更新历史**

### **2025-07-02**

- **新增功能**

  - **点火测试记录数据**：新增专门的点火测试分析表，为点火测试记录提供便捷数据。包含供氧启动时长、达峰时长、峰值维持时长（达峰到流量降至3.1L/min）、从启动到峰值结束供氧总量、反应总时长、总累积供氧等6项关键指标。数据展示各传感器独立值、平均值及所有传感器总计。

  - **平稳性分析**：新增高级稳定性分析功能，全面评估反应过程的流量稳定性。自动识别平稳期（总产氧量达20L到反应结束前120秒），进行线性拟合分析，计算相对基准线变异系数、最大偏差幅度、超调时间占比等多维度指标。配备60秒窗口滑动分析和分段着色的流量曲线全程分析图。

    > **技术特点**：采用scipy.stats线性回归确保统计准确性，稳定性评价分为优秀（CV<5%）、良好（5%≤CV<10%）、一般（10%≤CV<15%）、较差（CV≥15%）四级。图表采用创新的分段着色技术，灰色显示非平稳期，彩色突出平稳期，拟合直线叠加显示。

- **数据增强**

  - 原始数据表新增"累积总流量L"列：基于所有活跃传感器的实时累积流量，为平稳性分析提供基础数据。该数据自动适配2P/4P模式。

- **报表优化**

  - **综合异常分析**：将原本分散的"异常分析_1号"、"异常分析_2号"、"异常分析_3号"、"异常分析_4号"、"异常分析_平均值"等5个Sheet合并为一个"综合异常分析"Sheet。采用分组显示方式，每个传感器的异常数据用标题分隔，便于对比查看。

    > **优化效果**：减少Sheet数量，相关数据集中展示，提高报告的可读性和专业性。

  - **燃烧定位分析**：将原本的"燃烧定位表"和"燃烧定位数据"两个Sheet合并为一个"燃烧定位分析"Sheet。上部显示关键时间点（0、60、120...1200秒）的燃烧定位，下部显示每10秒采样的详细数据（最多30行），超出部分自动添加说明。

    > **设计理念**：既保留了关键数据的快速查看，又提供了详细数据的查询功能，避免数据过多造成的视觉混乱。

- **架构优化**

  - 模块化设计：平稳性分析相关函数独立封装（calculate_cumulative_flow、find_stable_period、linear_fit等），提高代码可维护性。
  - 报告格式优化：平稳性分析采用结构化布局，包含四个分节（平稳期边界信息、线性拟合参数、稳定性指标、滑动窗口分析），每项指标配有详细说明。
  - 跨平台兼容：所有新功能保持Windows/Mac双平台兼容性，支持PyInstaller打包。



### **2025-06-30**

- 新增功能

  - 数据清洗功能：新增Savitzky-Golay滤波器对流量数据进行平滑处理，去除噪点，使曲线更平滑。保留前导零值不进行清洗，确保启动时长计算的准确性。

    > **Savitzky-Golay滤波器原理**：该滤波器通过对数据窗口内的点进行多项式拟合，用拟合值替代中心点，从而实现平滑。相比简单的移动平均，它能更好地保留信号的形状特征（如峰值），同时有效去除高频噪声。本项目使用11点窗口和3阶多项式，在去噪和保真之间达到良好平衡。

  - 温度数据处理：支持读取CSV格式的温度数据文件（CH1-CH3通道），自动进行2秒采样到0.5秒的插值对齐。支持多种编码格式（gbk, gb2312, utf-8, cp1252, latin1）。

    > **温度数据要求**：温度表的起始数据时间点必须与流量原始表的起始点对齐（即两者都从反应开始的0时刻开始记录），结束时间无要求。程序会自动处理不同长度的数据。

  - **流量-温度综合分析图**：新增双Y轴图表，左侧显示平均流量（L/Min），右侧显示温度（°C），直观展示流量与温度的相关性。

- 重要修复

  - **0.9阈值异常分析修正**：修复了反应结束时间的定义——现在正确识别为所有活跃传感器流量都不为0的最后时刻，而非数据采集的结束时刻。这确保了窗口时间（7分钟后到实际结束前2分钟）的准确计算。
  - **时间精度处理**：原始数据表保持0.5秒采样精度，图表横坐标简化为整数秒显示，提高可读性。

- 基准曲线更新

  - 更新了基准曲线数据，新曲线保持相同格式（time,flow），可直接替换使用。主要变化包括启动阶段流量更高（0.17分钟达到3.1L/min），中期流量调整等。



### **2025-06-24**



- **新增功能**

  

  - 增加了“平均异常分析表_0.9阈值”Sheet：在Excel报告中自动新增一张表，专门用于统计“第7分钟（420秒）起至燃尽前2分钟”区间内，平均流量低于**绝对0.9L/min**的所有异常时段及其持续时间、起止时刻、累积产氧量等信息。
  - 表格字段包括：开始时间（秒）、结束时间（秒）、持续时间（秒）、起点累积流量（升）、终点累积流量（升）。

  

- **窗口区间优化**

  

  - 异常分析的考察时间段为“点火第7分钟起至燃尽前2分钟”，窗口右端点自动适配每次实验的真实燃尽时间，保证分析科学合理。

  

- **原有分析表**

  

  - 其余所有数据分析、性能指标和异常分析表均未变更，继续保留基准曲线相关判据。

  

- **BUG修复&体验优化**

  

  - 处理了异常分析时段切分准确性，累计流量计算更为严谨，逻辑更稳健。

  

---
## 项目简介

本项目为化学产氧器测试报告自动生成工具，支持 Windows 和 macOS 双平台。通过读取原始测量表、基准曲线和刻度表，自动生成包含数据分析、关键点提取、性能指标、异常分析和曲线图的完整 Excel 报告，以及对应的图表 PNG。可通过 Python 直接运行，也可使用 PyInstaller 打包为独立可执行文件。

## 目录结构

```
├── reports_input/                    # 输入数据目录
│   ├── 副本氧气流量采集分析表YYYYMMDD.xlsx  # 原始测量表（按前缀匹配）
│   ├── .基准曲线 1.csv                # 基准曲线数据
│   └── .副本4P、2P22M氧烛分层及刻度.xlsx  # 刻度表（4P22M/2P22M）
│
├── reports_output/                   # 输出报告目录（脚本运行自动创建）
│   └── 分析报告_YYYYMMDD_HHMMSS.xlsx    # 生成的完整报告
│
├── generate_reports_cross_platform.py # 跨平台主脚本
├── requirements.txt                  # Python 依赖列表
├── .github/
│   └── workflows/build.yml           # CI/CD 配置（GitHub Actions）
└── README.md                         # 本说明文件
```

## 环境要求

- Python 3.7+
- Windows 10 / macOS 10.15+
- 安装依赖：`pip install -r requirements.txt`

## 使用方法

1. **准备输入数据**，将以下文件放入 `reports_input/` 目录：
   - 原始测量表：
     - 格式：质量流量仪导出的Excel表格（xlsx格式）
     - 文件名以"副本氧气流量采集分析表"开头
     - 数据采样频率：0.5秒
   - 温度数据：
     - 格式：CSV文件，包含CH1、CH2、CH3列
     - 采样频率：2秒
     - 支持多种编码格式
     - **重要**：起始时间点必须与流量表对齐（都从0时刻开始），结束时间无要求

2. 运行脚本：

```bash
python generate_reports_cross_platform.py
```

3. 查看 `reports_output/` 目录，获取带有以下工作表的完整报告：

   - 原始数据

   - 关键点分析

   - 性能指标分析

   - 燃烧定位表

   - 异常分析_1号 … 异常分析_4号

   - 异常分析_平均值

   - 曲线图、产氧-深度曲线

   - 燃烧定位数据

   - 平均异常分析表_0.9阈值（2025-6-24更新加入）

## 打包为可执行文件

使用 PyInstaller 将脚本打包：

```bash
pyinstaller --onefile --name="报告生成器" generate_reports_cross_platform.py
```

打包完成后，可在 `dist/` 目录下获取 `报告生成器.exe`（Windows）或可执行文件（macOS）。

## CI/CD（GitHub Actions）

- Workflow 文件：`.github/workflows/build.yml`
- 每次推送（push）或发布（tag）时，自动安装依赖并执行 PyInstaller 打包，上传产物为 GitHub Release 附件。

## 贡献与许可证

欢迎提交 Issue 和 Pull Request。请遵循项目的编码规范和测试流程。

本项目采用 MIT 许可证，详情参见 LICENSE 文件。