# 氧气流量曲线平稳性分析方法与原理说明

## 一、目的

评估氧气流量数据的平稳程度，以量化改进工艺后的变化趋势，判断氧烛产品产氧过程是否趋于稳定，是否更接近理想状态。

基于化学产氧器工程特性，采用产氧总量和反应时间的工程化定义，确保分析结果具有明确的工程指导意义。

---

## 二、分析方法总览

| 步骤 | 方法 | 说明 |
|------|------|------|
| 1 | 数据预处理 | 时间对齐、插值补全、去除噪点 |
| 2 | 多通道平均 | 计算各测量通道的平均流量曲线 |
| 3 | 工程边界确定 | 基于产氧20L起点和反应结束前120s终点 |
| 4 | 平稳期提取 | 提取工程定义的平稳产氧阶段数据 |
| 5 | 线性拟合 | 对平稳期平均曲线进行基准线拟合 |
| 6 | 偏差计算 | 计算实际曲线相对基准线的偏差序列 |
| 7 | 波动性分析 | 基于偏差序列计算变异系数等稳定性指标 |
| 8 | 质量评估 | 多试验排名对比，生成工艺质量报告 |
| 9 | 滑动窗口分析 | 识别平稳期内的局部不稳定区域 |

---

## 三、工程化平稳期定义

### 3.1 定义原理

基于化学产氧器的实际工作特性，将平稳产氧阶段定义为：
- **起点**：产氧总量达到20L的时间点
- **终点**：反应结束前120秒的时间点  
- **工程意义**：该阶段避开初期点火不稳定和末期反应衰减，代表产氧器的稳定工作状态

### 3.2 边界确定算法

```
步骤1：读取累积流量数据（单位：m³，需转换为L）
步骤2：找到累积流量 ≥ 20L 的第一个时间点 → 平稳期起点
步骤3：确定反应结束时间（数据末尾或流量归零点）
步骤4：计算平稳期终点 = 反应结束时间 - 120秒
步骤5：验证起点 < 终点，否则标记为异常试验
```

### 3.3 优势与适用性

- **消除主观性**：避免人工标注的不一致性
- **工程导向**：直接对应产氧器实际工作需求
- **通用性强**：适用于不同工况和设备型号
- **自动化友好**：便于集成到自动分析系统

---

## 四、平稳性指标计算

### 4.1 数据预处理

**多曲线平均处理：**
- 分析对象为多个测量通道的**平均流量曲线**

- 计算方法：
  $$
  ȳ(t) = Σyi(t)/n （其中n为通道数）
  $$

- 优势：消除单通道偶发异常，提供更稳定的分析基础

### 4.2 基准趋势线拟合

**线性拟合方法：**
对平稳期内的平均流量数据进行最小二乘法线性拟合：
$$
\hat{y}(t) = at + b
$$


其中：
- a, b 为拟合系数

- $$
  \hat{y}(t)为基准趋势线
  $$

- 拟合目标：
  $$
  \min \sum_{i=1}^{n}[y(t_i) - \hat{y}(t_i)]^2
  $$
  

**作用：**

- 提取平稳期的整体趋势
- 为波动分析提供理想基准
- 分离趋势变化与随机波动

### 4.3 波动偏差计算

**偏差序列：**
$$
\delta(t) = y(t) - \hat{y}(t)
$$


其中 
$$
\delta(t)为实际流量相对于基准线的偏差
$$
 

### 4.4 核心稳定性指标

#### 4.4.1 相对基准线变异系数

**定义：**  
$$
\text{CV} = \frac{\sigma_\delta}{\bar{y}}
$$


其中：
- $$
  \sigma_\delta为偏差序列的标准差
  $$

- $$
  \sigma_\delta = \sqrt{\frac{1}{n} \sum_{i=1}^{n} \delta(t_i)^2}
  $$

- $$
  \bar{y}为平稳期平均流量
  $$

**作用：**  

- 量化相对于理想直线的波动程度
- 消除整体趋势对稳定性评估的影响
- 工艺改进的核心评估指标

#### 4.4.2 最大偏差幅度

**定义：**  
$$
\text{最大偏差} = \max(|\delta(t)|)
$$


**作用：**  

- 控制最大偏离基准线的程度
- 评估极值波动控制能力

#### 4.4.3 超调时间占比

**定义：**  
$$
\text{超调占比} = \frac{|\delta(t)| > 阈值的时间点数}{总时间点数} \times 100\%
$$


**作用：**  
- 评估偏离基准线的频繁程度
- 量化波动的持续性影响
- 目前设定为平稳期平均流量的 ±15%

#### 4.4.4 趋势一致性

**定义：**  
$$
\text{相关系数} = \frac{\sum_{i=1}^{n}(y(t_i) - \bar{y})(\hat{y}(t_i) - \bar{\hat{y}})}{\sqrt{\sum_{i=1}^{n}(y(t_i) - \bar{y})^2 \sum_{i=1}^{n}(\hat{y}(t_i) - \bar{\hat{y}})^2}}
$$


**作用：**  

- 判断实际曲线是否跟随基准趋势
- 识别系统性偏离与随机波动

### 4.5 辅助产氧效率指标

#### 4.5.1 平稳期产氧效率

**有效产氧量：**  
平稳期内的产氧增量（终点累积量 - 起点累积量）

**产氧效率：**  
$$
\text{效率} = \frac{\text{有效产氧量}}{\text{平稳期持续时间}}
$$


#### 4.5.2 启动响应时间

**定义：** 从反应开始到产氧量达到20L的时间

**作用：** 评估工艺启动性能和响应速度

---

## 五、工艺质量评估体系

### 5.1 质量指标定义

| 指标名称 | 计算方法 | 工程意义 | 优化方向 |
|----------|----------|----------|----------|
| 相对基准线变异系数 | σ_δ/μ | 相对理想直线的波动程度 | 越小越好 |
| 最大偏差幅度 | max(\|δ(t)\|) | 最大偏离基准线程度 | 越小越好 |
| 超调时间占比 | 超阈值时间/总时间×100% | 偏离频繁程度 | 越小越好 |
| 趋势一致性 | 相关系数 | 跟随基准趋势能力 | 越接近1越好 |
| 平稳期持续时间 | t_end - t_start | 稳定工作时长 | 越长越好 |
| 有效产氧量 | V_end - V_start | 稳定阶段贡献 | 越大越好 |
| 启动响应时间 | 达到20L的时间 | 启动性能 | 越短越好 |

### 5.2 多试验比较排名体系

#### 5.2.1 单指标排名方法

**排名规则：**
- 对每个质量指标，将所有试验按优劣排序
- 最优试验得1分，次优得2分，依此类推
- 分数越低表示该指标表现越好

**示例（5次试验的平均流量曲线分析）：**

| 试验编号 | 相对基准CV | CV排名 | 最大偏差 | 偏差排名 | 持续时间 | 时间排名 |
|----------|------------|--------|----------|----------|----------|----------|
| 试验A | 0.125 | 2 | 0.18 | 1 | 1850s | 3 |
| 试验B | 0.110 | 1 | 0.22 | 3 | 1920s | 1 |
| 试验C | 0.145 | 4 | 0.25 | 4 | 1680s | 5 |
| 试验D | 0.138 | 3 | 0.20 | 2 | 1780s | 4 |
| 试验E | 0.152 | 5 | 0.28 | 5 | 1890s | 2 |

#### 5.2.2 综合质量评分

**加权评分方法：**
$$
\text{综合得分} = \sum_{i=1}^{n} w_i \times R_i
$$


其中 
$$
w_i为第i个指标的权重
$$

$$
R_i为该指标的排名分数
$$


**推荐权重设置：**

- 相对基准线变异系数：35%（核心稳定性指标）
- 最大偏差幅度：25%（极值控制）
- 平稳期持续时间：20%（稳定性持续能力）
- 趋势一致性：10%（系统性评估）
- 启动响应时间：10%（启动性能）

#### 5.2.3 质量等级划分

基于综合得分的相对排名进行等级划分：

**优秀级（A级）**
- 综合排名前20%的试验
- 多项关键指标表现突出

**良好级（B级）**  
- 综合排名前20%-50%的试验
- 大部分指标表现良好

**合格级（C级）**
- 综合排名前50%-80%的试验
- 基本指标达到可接受水平

**待改进级（D级）**
- 综合排名后20%的试验
- 多项指标需要改进

### 5.3 工艺改进效果评估

#### 5.3.1 改进前后对比

**对比方法：**
1. 建立改进前基线组（3-5次试验）
2. 实施工艺改进
3. 进行改进后验证组（3-5次试验）
4. 对比两组试验的指标分布和排名

**评估指标：**
- 关键指标均值改善程度
- 指标稳定性（组内变异系数）
- 最优试验的指标提升幅度

#### 5.3.2 趋势分析

**持续改进监控：**
- 记录每批次试验的最优、平均、最差指标值
- 绘制指标趋势图，监控改进效果
- 识别指标波动异常，及时调整工艺参数

### 5.4 滑动窗口质量分析

**目的：** 识别平稳期内的局部不稳定区域

**方法：**
- 窗口大小：60秒
- 步长：10秒  
- 在平稳期内滑动计算局部CV和最大斜率
- 标记超出历史数据分位数的时间段

**输出：**
- 不稳定时间段列表
- 相对于历史数据的质量水平
- 局部质量热力图

---

## 六、基于工程定义的算法参数

### 6.1 数据积累与参数优化

**数据收集策略：**
- 建立试验数据库，记录每次试验的完整质量指标
- 分工况存储数据（不同温度、压力、配方等）
- 定期统计指标分布，为参数设定提供依据

**典型数据示例（基于0627低温试验）：**
- 平稳期起点：810秒（产氧量20L）
- 平稳期终点：2716秒（反应结束前120s）
- 持续时间：1906秒
- 平均流量：1.541 L/min
- 变异系数：0.1380
- 最大斜率：0.2230 L/min/s

*注：此数据仅作为方法验证示例，不作为质量基准*

### 6.2 算法参数调整策略

基于多次试验数据的统计分析，动态调整算法参数：

**参数调整原则：**
- **变异系数阈值**：设为历史数据75分位数值
- **最大斜率阈值**：设为历史数据75分位数值  
- **平均斜率阈值**：设为历史数据75分位数值
- **滑动窗口**：固定60秒（平衡精度与效率）
- **最小持续时间**：固定100秒（局部分析最小单元）

**动态更新机制：**
- 每积累5-10次试验数据，重新计算分位数阈值
- 确保算法参数随工艺改进和数据积累持续优化
- 避免固定阈值导致的适用性问题

**示例参数设置：**

| 参数类型 | 计算方法 | 说明 |
|----------|----------|------|
| CV阈值 | P75(历史CV数据) | 75%试验的CV都在此值以下 |
| 斜率阈值 | P75(历史斜率数据) | 75%试验的最大斜率都在此值以下 |
| 质量基准 | 滚动平均值 | 最近10次试验的平均指标值 |

### 6.3 算法实施流程

#### 6.3.1 平稳期边界确定

```
输入：各通道瞬时流量数据、累积流量数据
输出：[平稳期起点, 平稳期终点]

1. 计算多通道平均流量曲线：y_avg(t) = Σy_i(t)/n
2. 找到累积流量 ≥ 20L 的第一个时间点 → t_start
3. 确定反应结束时间 t_reaction_end
4. 计算 t_end = t_reaction_end - 120s
5. 验证 t_start < t_end，否则返回异常标志
6. 返回 [t_start, t_end]
```

#### 6.3.2 基准线拟合与偏差计算

```
输入：平稳期平均流量数据 y_avg(t)
输出：偏差序列 δ(t)

1. 对平稳期数据进行线性拟合：ŷ(t) = at + b
2. 计算偏差序列：δ(t) = y_avg(t) - ŷ(t)  
3. 返回偏差序列和拟合参数
```

#### 6.3.3 平稳性质量评估

```
输入：偏差序列 δ(t)、平均流量 y_avg(t)
输出：质量评估报告

1. 计算相对基准线CV：σ_δ/mean(y_avg)
2. 计算最大偏差：max(|δ(t)|)
3. 计算超调时间占比和趋势一致性
4. 与历史数据对比，确定相对排名
5. 执行滑动窗口分析，识别局部不稳定区域
6. 生成综合质量报告和改进建议
```

### 6.4 算法优势

- **工程边界明确**：基于产氧量和反应时间的客观标准
- **参数数据驱动**：基于实际试验数据标定，具有实用性
- **自动化程度高**：无需人工干预即可完成分析
- **结果可对比**：不同试验具有统一的评估标准

---

## 七、实际应用指南

### 7.1 多通道平均流量分析

**分析对象：** 仅针对多通道的平均流量曲线进行分析

**数据处理流程：**
1. **多通道数据读取**：获取各测量通道的瞬时流量数据
2. **平均曲线计算**：ȳ(t) = Σyi(t)/n
3. **基准线拟合**：对平稳期平均曲线进行线性拟合
4. **波动分析**：基于偏差序列计算各项稳定性指标

**优势：**
- 避免单通道偶发异常对整体评估的影响
- 提供更稳定和代表性的分析结果
- 简化分析流程，提高评估效率
- 更好地反映系统整体性能水平

### 7.2 参数调整指南

**20L起点调整：**
- 如需更早进入评估：降低至15L
- 如初期波动严重：提高至25L

**120s终点余量调整：**
- 如末期衰减严重：增加至180s
- 如反应持续稳定：减少至60s

**质量阈值调整：**
- 根据具体应用要求和设备精度调整CV和偏差阈值
- 建议基于多批次数据统计确定合理范围

